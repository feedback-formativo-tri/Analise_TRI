---
title: "R Notebook"
output: html_notebook
---

#PACOTES E CHAMADA DE BIBLIOTECA
```{r}
# install.packages("ltm") #2.1_1
# install.packages("dplyr")
```

```{r}
library(ltm) #2.1_2
library(dplyr)
```

#Leitura das matrizes binárias
```{r}

matriz_LC_binaria_PR_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_LC_BINARIA_PR_amarela.csv", header = TRUE, sep= ",")
matriz_LC_binaria_PR_amarela <- matriz_LC_binaria_PR_amarela[,-c(1)]

matriz_CN_binaria_PR_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_CN_BINARIA_PR_amarela.csv", header = TRUE, sep= ",")
matriz_CN_binaria_PR_amarela <- matriz_CN_binaria_PR_amarela[,-c(1)]

matriz_CH_binaria_PR_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_CH_BINARIA_PR_amarela.csv", header = TRUE, sep= ",")
matriz_CH_binaria_PR_amarela <- matriz_CH_binaria_PR_amarela[,-c(1)]

matriz_MT_binaria_PR_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_MT_BINARIA_PR_amarela.csv", header = TRUE, sep= ",")
matriz_MT_binaria_PR_amarela <- matriz_MT_binaria_PR_amarela[,-c(1)]

matriz_LC_binaria_PA_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_LC_BINARIA_PA_amarela.csv", header = TRUE, sep= ",")
matriz_LC_binaria_PA_amarela <- matriz_LC_binaria_PA_amarela[,-c(1)]

matriz_CN_binaria_PA_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_CN_BINARIA_PA_amarela.csv", header = TRUE, sep= ",")
matriz_CN_binaria_PA_amarela <- matriz_CN_binaria_PA_amarela[,-c(1)]

matriz_CH_binaria_PA_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_CH_BINARIA_PA_amarela.csv", header = TRUE, sep= ",")
matriz_CH_binaria_PA_amarela <- matriz_CH_binaria_PA_amarela[,-c(1)]

matriz_MT_binaria_PA_amarela <- read.table("pre-processamento/matrizes_binarias/MATRIZ_MT_BINARIA_PA_amarela.csv", header = TRUE, sep= ",")
matriz_MT_binaria_PA_amarela <- matriz_MT_binaria_PA_amarela[,-c(1)]
```

#Aplicação do modelo ltm nas matrizes binarias das areas
```{r Aplicação do modelo ltm nas matrizes binarias das areas}
modelo_LTM_3PL <- function(matriz_binaria) {
  mod.3pl <- tpm(matriz_binaria,type = "latent.trait", IRT.param=TRUE) # 2. 2_5
  return(mod.3pl)
}
```
#Aplicação do Modelo LTM 2PL para todas as areas do Amazonas
```{r}
modelo_3PL_LTM_LC_PR <- modelo_LTM_3PL(matriz_LC_binaria_PR_amarela[2:46])
modelo_3PL_LTM_CH_PR <- modelo_LTM_3PL(matriz_CH_binaria_PR_amarela[2:46])
modelo_3PL_LTM_CN_PR <- modelo_LTM_3PL(matriz_CN_binaria_PR_amarela[2:46])
modelo_3PL_LTM_MT_PR <- modelo_LTM_3PL(matriz_MT_binaria_PR_amarela[2:45])
```

#Aplicação do Modelo LTM 2PL Modelo para todas as areas do Espirito Santo
```{r}
modelo_3PL_LTM_LC_PA <- modelo_LTM_3PL(matriz_LC_binaria_PA_amarela[2:46])
modelo_3PL_LTM_CH_PA <- modelo_LTM_3PL(matriz_CH_binaria_PA_amarela[2:46])
modelo_3PL_LTM_CN_PA <- modelo_LTM_3PL(matriz_CN_binaria_PA_amarela[2:46])
modelo_3PL_LTM_MT_PA <- modelo_LTM_3PL(matriz_MT_binaria_PA_amarela[2:45])
```

#Dificuldade do ITEM e sua discriminação
```{r Dificuldade do ITEM e sua discriminação}
dificuldade_LTM_3PL <- function(modelo,questao) {
  coef_df <- as.data.frame(coef(modelo))
  #questao <- c(1:45)
  coef_df <- rename(coef_df, "dificuldade_item" = "Dffclt")
  coef_df <- rename(coef_df, "discriminacao_item" = "Dscrmn")
  coef_df <- rename(coef_df,"acerto_acaso_item" = "Gussng")
  coef_df$questao <- questao
  #coef_df <- select(coef_df, questao, dificuldade_item, discriminacao_item,acerto_acaso_item) #reodernar colunas
  return(coef_df)
}
```

#FUNÇÃO: Concatenação das colunas de respostas 
```{r Concatenação das colunas de respostas }
concatenar_colunas <- function(dataframe,inicio,fim) {
  dataframe$respostas <- apply(dataframe[,inicio:fim], 1, function(x) paste(x, collapse = ""))
  return(dataframe)
}
```

```{r}
summarize_data <- function(dataframe) {
  df_novo <- dataframe %>%
    group_by(respostas) %>%
    summarise(Ocorrência = n(),alunos_id_string = toString(matricula))
    #summarise(Ocorrência = n(), alunos_id_list = list(matricula),alunos_id_string = toString(matricula)) Type list não é salvo em CSV
  return(df_novo)
}
```

#FUNÇÃO: Nesta função, percorremos cada valor da coluna "respostas" do dataframe_X e comparamos com cada valor da coluna "respostas" do dataframe_Y. Se houver uma correspondência, o valor é adicionado à coluna "novas_respostas" e o valor correspondente da coluna "z1" do dataframe_X é adicionado à coluna "habilidade".
```{r}
comparar_dataframes <- function(dataframe_X, dataframe_Y) {
  # Filtra as linhas do dataframe_X que possuem a mesma resposta no dataframe_Y
  linhas_comuns <- dataframe_X[dataframe_X$respostas %in% dataframe_Y$respostas, ]
  
  # Compara as respostas e concatena as linhas correspondentes dos dois dataframes
  dataframe_Z <- cbind(linhas_comuns, dataframe_Y[dataframe_Y$respostas %in% linhas_comuns$respostas, ])
  # Remove as colunas duplicadas
  dataframe_Z <- dataframe_Z[, !duplicated(colnames(dataframe_Z))]
  colnames(dataframe_Z)[colnames(dataframe_Z) == "z1"] <- "habilidade"
  return(dataframe_Z)
}
```


```{r}
vetor1 <- c(1:45)
vetor_MT <- c(1:39,41:45)

dif_modelo_3PL_ltm_LC_PR <- dificuldade_LTM_3PL(modelo_3PL_LTM_LC_PR,vetor1)
dif_modelo_3PL_ltm_MT_PR <- dificuldade_LTM_3PL(modelo_3PL_LTM_MT_PR,vetor_MT)
dif_modelo_3PL_ltm_CH_PR <- dificuldade_LTM_3PL(modelo_3PL_LTM_CH_PR,vetor1)
dif_modelo_3PL_ltm_CN_PR <- dificuldade_LTM_3PL(modelo_3PL_LTM_CN_PR,vetor1)


dif_modelo_3PL_ltm_LC_PA <- dificuldade_LTM_3PL(modelo_3PL_LTM_LC_PA,vetor1)
dif_modelo_3PL_ltm_MT_PA <- dificuldade_LTM_3PL(modelo_3PL_LTM_MT_PA,vetor_MT)
dif_modelo_3PL_ltm_CH_PA <- dificuldade_LTM_3PL(modelo_3PL_LTM_CH_PA,vetor1)
dif_modelo_3PL_ltm_CN_PA <- dificuldade_LTM_3PL(modelo_3PL_LTM_CN_PA,vetor1)

```

#WRITE DIFICULDADE CSV AM E ES
```{r} 
write.table(dif_modelo_3PL_ltm_LC_PR, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_LC_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(dif_modelo_3PL_ltm_CN_PR, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_CN_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(dif_modelo_3PL_ltm_CH_PR, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_CH_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(dif_modelo_3PL_ltm_MT_PR, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_MT_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")

write.table(dif_modelo_3PL_ltm_LC_PA, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_LC_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(dif_modelo_3PL_ltm_CN_PA, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_CN_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(dif_modelo_3PL_ltm_CH_PA, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_CH_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(dif_modelo_3PL_ltm_MT_PA, file = "codigos_R/LTM_3PL/dificuldades/dif_modelo_3PL_ltm_MT_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
```

#APLICAÇÃO DA factor.scores no modeo LTM 3PL AM (Gera habilidade)
```{r}
habil_3PL_ltm_LC_PR <- factor.scores(modelo_3PL_LTM_LC_PR, impute=FALSE)
habil_3PL_ltm_MT_PR <- factor.scores(modelo_3PL_LTM_MT_PR, impute=FALSE)
habil_3PL_ltm_CN_PR <- factor.scores(modelo_3PL_LTM_CN_PR, impute=FALSE)
habil_3PL_ltm_CH_PR <- factor.scores(modelo_3PL_LTM_CH_PR, impute=FALSE)

#APLICAÇÃO DA factor.scores no modeo LTM 2PL ES
habil_3PL_ltm_LC_PA <- factor.scores(modelo_3PL_LTM_LC_PA, impute=FALSE)
habil_3PL_ltm_MT_PA <- factor.scores(modelo_3PL_LTM_MT_PA, impute=FALSE)
habil_3PL_ltm_CN_PA <- factor.scores(modelo_3PL_LTM_CN_PA, impute=FALSE)
habil_3PL_ltm_CH_PA <- factor.scores(modelo_3PL_LTM_CH_PA, impute=FALSE)
```

```{r}
habil_3PL_ltm_LC_PR
habil_3PL_ltm_CH_PR
habil_3PL_ltm_CN_PR
habil_3PL_ltm_MT_PR
habil_3PL_ltm_LC_PA
habil_3PL_ltm_CH_PA
habil_3PL_ltm_CN_PA
habil_3PL_ltm_MT_PA
```
#Utilização da função concatenar_colunas para ter uma chave de busca para as matrizes
```{r}
matriz_MT_binaria_PR_amarela <- concatenar_colunas(matriz_MT_binaria_PR_amarela,2,45)
matriz_CN_binaria_PR_amarela <- concatenar_colunas(matriz_CN_binaria_PR_amarela,2,46)
matriz_LC_binaria_PR_amarela <- concatenar_colunas(matriz_LC_binaria_PR_amarela,2,46)
matriz_CH_binaria_PR_amarela <- concatenar_colunas(matriz_CH_binaria_PR_amarela,2,46)

matriz_MT_binaria_PA_amarela <- concatenar_colunas(matriz_MT_binaria_PA_amarela,2,45)
matriz_CN_binaria_PA_amarela <- concatenar_colunas(matriz_CN_binaria_PA_amarela,2,46)
matriz_LC_binaria_PA_amarela <- concatenar_colunas(matriz_LC_binaria_PA_amarela,2,46)
matriz_CH_binaria_PA_amarela <- concatenar_colunas(matriz_CH_binaria_PA_amarela,2,46)
```

```{r}
matriz_CH_binaria_PR_amarela <- summarize_data(matriz_CH_binaria_PR_amarela)
matriz_LC_binaria_PR_amarela <- summarize_data(matriz_LC_binaria_PR_amarela)
matriz_MT_binaria_PR_amarela <- summarize_data(matriz_MT_binaria_PR_amarela)
matriz_CN_binaria_PR_amarela <- summarize_data(matriz_CN_binaria_PR_amarela)

matriz_CH_binaria_PA_amarela <- summarize_data(matriz_CH_binaria_PA_amarela)
matriz_LC_binaria_PA_amarela <- summarize_data(matriz_LC_binaria_PA_amarela)
matriz_MT_binaria_PA_amarela <- summarize_data(matriz_MT_binaria_PA_amarela)
matriz_CN_binaria_PA_amarela <- summarize_data(matriz_CN_binaria_PA_amarela)
```

#Utilização da função concatenar_colunas para ter uma chave de busca para a habilidade - AM
```{r}
habil_3PL_ltm_LC_PR <- concatenar_colunas(habil_3PL_ltm_LC_PR$score.dat,1,45)
habil_3PL_ltm_MT_PR <- concatenar_colunas(habil_3PL_ltm_MT_PR$score.dat,1,44)
habil_3PL_ltm_CN_PR <- concatenar_colunas(habil_3PL_ltm_CN_PR$score.dat,1,45)
habil_3PL_ltm_CH_PR <- concatenar_colunas(habil_3PL_ltm_CH_PR$score.dat,1,45)

habil_3PL_ltm_LC_PA <- concatenar_colunas(habil_3PL_ltm_LC_PA$score.dat,1,45)
habil_3PL_ltm_MT_PA <- concatenar_colunas(habil_3PL_ltm_MT_PA$score.dat,1,44)
habil_3PL_ltm_CN_PA <- concatenar_colunas(habil_3PL_ltm_CN_PA$score.dat,1,45)
habil_3PL_ltm_CH_PA <- concatenar_colunas(habil_3PL_ltm_CH_PA$score.dat,1,45)
```

#habilidade_2PL_LTM_AREAX_ESTADOY: Esse dataframe vai conter os padrões de respostas e suas respectivas habilidades, observações
```{r}
habil_3PL_ltm_LC_PR <- comparar_dataframes(habil_3PL_ltm_LC_PR, matriz_LC_binaria_PR_amarela)
habil_3PL_ltm_MT_PR <- comparar_dataframes(habil_3PL_ltm_MT_PR, matriz_MT_binaria_PR_amarela)
habil_3PL_ltm_CN_PR <- comparar_dataframes(habil_3PL_ltm_CN_PR, matriz_CN_binaria_PR_amarela)
habil_3PL_ltm_CH_PR <- comparar_dataframes(habil_3PL_ltm_CH_PR, matriz_CH_binaria_PR_amarela)

habil_3PL_ltm_LC_PA <- comparar_dataframes(habil_3PL_ltm_LC_PA, matriz_LC_binaria_PA_amarela)
habil_3PL_ltm_MT_PA <- comparar_dataframes(habil_3PL_ltm_MT_PA, matriz_MT_binaria_PA_amarela)
habil_3PL_ltm_CN_PA <- comparar_dataframes(habil_3PL_ltm_CN_PA, matriz_CN_binaria_PA_amarela)
habil_3PL_ltm_CH_PA <- comparar_dataframes(habil_3PL_ltm_CH_PA, matriz_CH_binaria_PA_amarela)
```

#Ordenar a tabela pela habilidade em ordem crescente
```{r}
habil_3PL_ltm_LC_PR <- habil_3PL_ltm_LC_PR[order(habil_3PL_ltm_LC_PR$habilidade,decreasing = FALSE), ]
habil_3PL_ltm_MT_PR <- habil_3PL_ltm_MT_PR[order(habil_3PL_ltm_MT_PR$habilidade,decreasing = FALSE), ]
habil_3PL_ltm_CN_PR <- habil_3PL_ltm_CN_PR[order(habil_3PL_ltm_CN_PR$habilidade,decreasing = FALSE), ]
habil_3PL_ltm_CH_PR <- habil_3PL_ltm_CH_PR[order(habil_3PL_ltm_CH_PR$habilidade,decreasing = FALSE), ]
#Ordenar a tabela pela habilidade em ordem crescente ES
habil_3PL_ltm_LC_PA <- habil_3PL_ltm_LC_PA[order(habil_3PL_ltm_LC_PA$habilidade,decreasing = FALSE), ]
habil_3PL_ltm_MT_PA <- habil_3PL_ltm_MT_PA[order(habil_3PL_ltm_MT_PA$habilidade,decreasing = FALSE), ]
habil_3PL_ltm_CN_PA <- habil_3PL_ltm_CN_PA[order(habil_3PL_ltm_CN_PA$habilidade,decreasing = FALSE), ]
habil_3PL_ltm_CH_PA <- habil_3PL_ltm_CH_PA[order(habil_3PL_ltm_CH_PA$habilidade,decreasing = FALSE), ]
```

#WRITE DIFICULDADE CSV AM E ES
```{r} 
write.table(habil_3PL_ltm_LC_PR, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_LC_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(habil_3PL_ltm_CN_PR, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_CN_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(habil_3PL_ltm_CH_PR, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_CH_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(habil_3PL_ltm_MT_PR, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_MT_PR.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")

write.table(habil_3PL_ltm_LC_PA, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_LC_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(habil_3PL_ltm_CN_PA, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_CN_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(habil_3PL_ltm_CH_PA, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_CH_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
write.table(habil_3PL_ltm_MT_PA, file = "codigos_R/LTM_3PL/habilidades/habil_3PL_ltm_MT_PA.csv",  sep = ",", quote = TRUE, row.names = TRUE, eol = "\r\n")
```

```{r}
#auxiliar <- read.table("G:/Meu Drive/faculdade/TCC_Leide_Marina/pre-processamento/matrizes_binarias/MATRIZ_LC_BINARIA_AM.csv", header = TRUE, sep= ",")
```

```{r}
#auxiliar <- auxiliar[, c("matricula","Q1","Q10","Q12","Q22","Q45")]
```

